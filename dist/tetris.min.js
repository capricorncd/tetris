/*! For license information please see tetris.min.js.LICENSE.txt */
(()=>{"use strict";var t={807:(t,e,r)=>{r.d(e,{Z:()=>g});var i=r(645),n=r.n(i),o=r(667),s=r.n(o),a=r(24),c=r(693),d=r(912),u=r(147),h=n()((function(t){return t[1]})),p=s()(a.Z),l=s()(c.Z),f=s()(d.Z),v=s()(u.Z);h.push([t.id,'.zx-tetris-container{position:relative;background-color:#333;display:flex}.zx-tetris-container button{outline:none;cursor:pointer;background:none}.zx-tetris-container .zx-tetris__inner{position:relative;display:flex}.zx-tetris-container .tetris-start-button-wrapper{position:absolute;z-index:10;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center}.zx-tetris-container .tetris-start-button-wrapper button{width:200px;height:50px;border-radius:25px;color:#ffd605;border:1px solid #ffd605}.zx-tetris-container .tetris-stage{position:relative;width:200px;height:400px;flex:0 0 200px}.zx-tetris-container .tetris-stage:after{display:block;position:relative;z-index:-1;top:50%;margin-top:-7px;width:100%;text-align:center;font-size:14px;line-height:1;color:#fff;content:"©Capricorncd";filter:Alpha(opacity=10);opacity:.1}.zx-tetris-container .tetris-sider-wrapper{position:relative;height:400px;margin-left:10px}.zx-tetris-container .tetris-sider-wrapper .next-square{width:80px;height:80px}.zx-tetris-container .tetris-sider-wrapper .tetris-statistics{margin-top:40px}.zx-tetris-container .tetris-sider-wrapper .tetris-statistics .game-times{color:#fff}.zx-tetris-container .tetris-sider-wrapper .tetris-statistics .game-scores{margin-top:20px;color:#fff}.zx-tetris-container .tetris-sider-wrapper .control-wrapper{position:absolute;left:0;bottom:50px}.zx-tetris-container .tetris-sider-wrapper .control-wrapper button{margin:0 0 20px 0;width:80px;height:30px;text-align:center;color:#ffd605;border:1px solid #ffd605;border-radius:24px}.zx-tetris-container .tetris-sider-wrapper .control-wrapper button.tetris-setup{color:#999;border-color:#999}.zx-tetris-container .tetris-sider-wrapper .control-wrapper button.tetris-pause{color:#7ddf66;border-color:#7ddf66}.zx-tetris-container .current{background:url('+p+") no-repeat 0 0}.zx-tetris-container .done{background:url("+l+") no-repeat 0 0}.zx-tetris-container .none{background:url("+f+") no-repeat 0 0;opacity:.2;filter:Alpha(opacity=20)}.zx-tetris-container .next-square .current{background:url("+v+') no-repeat 0 0;background-size:cover}.zx-tetris-container .next-square .none{background:none}.zx-tetris-container .none,.zx-tetris-container .current,.zx-tetris-container .done{position:absolute;width:20px;height:20px;box-sizing:border-box;background-size:cover}.zx-tetris-container .tetris-control-wrapper{display:none;position:absolute;left:0;right:0;bottom:0}.zx-tetris-container .tetris-control-wrapper .grid-wrapper{display:flex}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid{flex:1}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid button{display:block;width:100%;height:40px;color:#999;border:1px solid #999;background:none;box-sizing:border-box}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid button.btn-left{border-right:0}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid button.btn-right{border-left:0}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid button.btn-rotate{border-bottom:0}.zx-tetris-container .tetris-control-wrapper .grid-wrapper .grid button.btn-down{border-top:0}.game-over .tetris-pause{color:#999 !important;border-color:#999 !important}.game-over .done{background-size:cover}@media screen and (min-width: 375px){.zx-tetris-container .tetris-control-wrapper{position:absolute;top:420px;max-width:320px}}.ie-brower .tetris-control-wrapper{position:absolute;top:420px;left:0;width:320px}.ie-brower .tetris-control-wrapper .next-square .none{background:none !important}.ie-brower .tetris-control-wrapper .grid-wrapper{height:42px;overflow:hidden}.ie-brower .tetris-control-wrapper .grid-wrapper .grid{float:left;width:33.3%}.ie-brower .tetris-control-wrapper .grid-wrapper .grid:after{content:".";font-size:1px}',""]);const g=h},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=t(e);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,i){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(n[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);i&&n[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),e.push(c))}},e}},667:t=>{t.exports=function(t,e){return e||(e={}),"string"!=typeof(t=t&&t.__esModule?t.default:t)?t:(/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t)}},693:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"green.png"},912:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"none.png"},24:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"red.png"},147:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"yellow.png"},825:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"bgm.mp3"},225:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"death.mp3"},170:(t,e,r)=>{r.d(e,{Z:()=>i});const i=r.p+"remove.mp3"},379:(t,e,r)=>{var i,n=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}(),o=[];function s(t){for(var e=-1,r=0;r<o.length;r++)if(o[r].identifier===t){e=r;break}return e}function a(t,e){for(var r={},i=[],n=0;n<t.length;n++){var a=t[n],c=e.base?a[0]+e.base:a[0],d=r[c]||0,u="".concat(c," ").concat(d);r[c]=d+1;var h=s(u),p={css:a[1],media:a[2],sourceMap:a[3]};-1!==h?(o[h].references++,o[h].updater(p)):o.push({identifier:u,updater:v(p,e),references:1}),i.push(u)}return i}function c(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var o=r.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var s=n(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var d,u=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function h(t,e,r,i){var n=r?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,n);else{var o=document.createTextNode(n),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function p(t,e,r){var i=r.css,n=r.media,o=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var l=null,f=0;function v(t,e){var r,i,n;if(e.singleton){var o=f++;r=l||(l=c(e)),i=h.bind(null,r,o,!1),n=h.bind(null,r,o,!0)}else r=c(e),i=p.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var r=a(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<r.length;i++){var n=s(r[i]);o[n].references--}for(var c=a(t,e),d=0;d<r.length;d++){var u=s(r[d]);0===o[u].references&&(o[u].updater(),o.splice(u,1))}r=c}}}}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})();var i={};(()=>{r.r(i),r.d(i,{Tetris:()=>l});var t={q:function(t){return document.querySelector(t)},eventListener:function(t,e,r){t?t.addEventListener(e,r,!1):console.error("The this.eventListener() DOM node is undefined")},isIEBrower:"Microsoft Internet Explorer"===navigator.appName,ieBrowerVersion:function(){return/MSIE (\d+)/gi.test(navigator.userAgent)?+RegExp.$1:0},rand:function(t){return void 0===t&&(t=1),Math.ceil(Math.random()*t)},ft:function(e){var r=t.fd(Math.floor(e/60))+":"+t.fd(e%60);return e>3600?t.fd(Math.floor(e/3600))+":"+r:r},fd:function(t){return t<10?"0"+t:t+""},checkPoint:function(t,e,r,i){return!(t.x+e<0||t.x+e>=i.length||t.y+r<0||t.y+r>=i[0].length||1===i[t.x+e][t.y+r])}};const e=t,n=function(){function t(t){void 0===t&&(t=0),this.data=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.SQUARES={1:[[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]],[[0,0,0,0],[2,2,2,2],[0,0,0,0],[0,0,0,0]]],2:[[[2,0,0,0],[2,2,0,0],[0,2,0,0],[0,0,0,0]],[[0,2,2,0],[2,2,0,0],[0,0,0,0],[0,0,0,0]]],3:[[[2,0,0,0],[2,0,0,0],[2,2,0,0],[0,0,0,0]],[[2,2,2,0],[2,0,0,0],[0,0,0,0],[0,0,0,0]],[[2,2,0,0],[0,2,0,0],[0,2,0,0],[0,0,0,0]],[[0,0,2,0],[2,2,2,0],[0,0,0,0],[0,0,0,0]]],4:[[[0,2,0,0],[0,2,0,0],[2,2,0,0],[0,0,0,0]],[[2,0,0,0],[2,2,2,0],[0,0,0,0],[0,0,0,0]],[[2,2,0,0],[2,0,0,0],[2,0,0,0],[0,0,0,0]],[[2,2,2,0],[0,0,2,0],[0,0,0,0],[0,0,0,0]]],5:[[[2,0,0,0],[2,2,0,0],[2,0,0,0],[0,0,0,0]],[[2,2,2,0],[0,2,0,0],[0,0,0,0],[0,0,0,0]],[[0,2,0,0],[2,2,0,0],[0,2,0,0],[0,0,0,0]],[[0,2,0,0],[2,2,2,0],[0,0,0,0],[0,0,0,0]]],6:[[[2,2,0,0],[2,2,0,0],[0,0,0,0],[0,0,0,0]],[[2,2,0,0],[2,2,0,0],[0,0,0,0],[0,0,0,0]]],7:[[[0,2,0,0],[2,2,0,0],[2,0,0,0],[0,0,0,0]],[[2,2,0,0],[0,2,2,0],[0,0,0,0],[0,0,0,0]]]},this.origin={x:0,y:0},this.dir=0,this.rotates=this.SQUARES[t]}return t.prototype.isValid=function(t,r,i){for(var n=0;n<r.length;n++)for(var o=0;o<r[0].length;o++)if(0!==r[n][o]&&!e.checkPoint(t,n,o,i))return!1;return!0},t.prototype.canRotate=function(t){for(var e=this.rotates.length,r=(this.dir+1)%e,i=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],n=0;n<this.data.length;n++)for(var o=0;o<this.data[0].length;o++)i[n][o]=this.rotates[r][n][o];return this.isValid(this.origin,i,t)},t.prototype.rotate=function(t){var e,r;for(void 0===t&&(t=1),this.dir=(this.dir+t)%this.rotates.length,e=0;e<this.data.length;e++)for(r=0;r<this.data[0].length;r++)this.data[e][r]=this.rotates[this.dir][e][r]},t.prototype.canDown=function(t){var e={};return e.x=this.origin.x+1,e.y=this.origin.y,this.isValid(e,this.data,t)},t.prototype.down=function(){this.origin.x+=1},t.prototype.canLeft=function(t){var e={};return e.x=this.origin.x,e.y=this.origin.y-1,this.isValid(e,this.data,t)},t.prototype.left=function(){this.origin.y-=1},t.prototype.canRight=function(t){var e={};return e.x=this.origin.x,e.y=this.origin.y+1,this.isValid(e,this.data,t)},t.prototype.right=function(){this.origin.y+=1},t.prototype.canUp=function(t){var e={};return e.x=this.origin.x-1,e.y=this.origin.y,this.isValid(e,this.data,t)},t.prototype.up=function(){this.origin.x-=1},t}();var o={container:"body",ready:function(){},error:function(){}},s=r(379),a=r.n(s),c=r(807);a()(c.Z,{insert:"head",singleton:!1}),c.Z.locals;var d=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))},u=function(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},h=function(){function t(){this.context=new AudioContext,this.audio=this.createAudio(),this.buffers={},this.sources={}}return t.prototype.addSource=function(t,e){return d(this,void 0,void 0,(function(){var r,i;return u(this,(function(n){switch(n.label){case 0:return[4,fetch(e)];case 1:return[4,n.sent().arrayBuffer()];case 2:return r=n.sent(),[4,this.context.decodeAudioData(r)];case 3:return i=n.sent(),this.buffers[t]=i,[2]}}))}))},t.prototype.createAudio=function(){var t=new Audio;return document.querySelector("body").append(t),t},t.prototype.play=function(t,e){if(void 0===e&&(e=!1),this.sources[t])this.sources[t].connect(this.context.destination);else{var r=this.context.createBufferSource();r.connect(this.context.destination),this.buffers[t]&&(r.buffer=this.buffers[t],r.start(),r.loop=e,e&&(this.sources[t]=r),r.addEventListener("ended",(function(){r=null})))}},t.prototype.pause=function(t){this.sources[t]&&this.sources[t].disconnect(this.context.destination)},t.prototype.stop=function(){return d(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return[4,this.context.resume()];case 1:return t.sent(),[2]}}))}))},t}(),p=function(){return(p=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},l=function(){function t(t){this.INTERVAL=500,this.moveTimer=null,this.gameTimer=null,this.gameTimes=0,this.isGameOver=!1,this.isPause=!1,this.gameScores=0,this.stageArray=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.currSquare=null,this.nextSquare=null,this.stageDivs=[],this.nextDivs=[],this.outerDom=null,this.dom=null,this.domId="Tetris_"+(new Date).getTime(),this.opts=p(p({},o),t),this.outerDom=e.q(this.opts.container),this.audio=new h,this.audio.addSource("bgm",r(825).Z),this.audio.addSource("death",r(225).Z),this.audio.addSource("remove",r(170).Z),this.init()}return t.prototype.createGameDom=function(){this.dom=document.createElement("div"),this.dom.className="zx-tetris-container",this.dom.id=this.domId,this.dom.innerHTML='\n      <section class="zx-tetris__inner">\n      <div class="tetris-start-button-wrapper"><button>Start</button></div>\n      <div class="tetris-stage"></div>\n      <div class="tetris-sider-wrapper">\n        <div class="next-square"></div>\n        <div class="tetris-statistics">\n          <div class="game-times">\n            <span class="times">00:00</span>\n          </div>\n          <div class="game-scores">\n            <span class="score">0</span>\n          </div>\n        </div>\n        <div class="control-wrapper">\n\x3c!--          <button class="tetris-setup">Setup</button>--\x3e\n          <button class="tetris-restart">Restart</button>\n          <button class="tetris-pause">Pause</button>\n        </div>\n      </div>\n\n      <div class="tetris-control-wrapper">\n        <div class="grid-wrapper">\n          <div class="grid"></div>\n          <div class="grid">\n            <button class="btn-rotate">Rotate</button>\n          </div>\n          <div class="grid"></div>\n        </div>\n        <div class="grid-wrapper">\n          <div class="grid">\n            <button class="btn-left">Left</button>\n          </div>\n          <div class="grid">\n            <button class="btn-fall">OK</button>\n          </div>\n          <div class="grid">\n            <button class="btn-right">Right</button>\n          </div>\n        </div>\n        <div class="grid-wrapper">\n          <div class="grid"></div>\n          <div class="grid">\n            <button class="btn-down">Down</button>\n          </div>\n          <div class="grid"></div>\n        </div>\n      </div>\n      </section>\n    ',this.outerDom?(this.outerDom.innerHTML="",this.outerDom.appendChild(this.dom),this.opts.ready({code:0,msg:"Tetris readied in '"+this.opts.container+"'"})):this.opts.error({code:2,msg:"创建Tetris DOM失败，请升级浏览器或引入jQuery/Zepte库"})},t.prototype.gameController=function(){var t=this;e.eventListener(document,"keydown",(function(e){e.preventDefault();var r=e.keyCode,i=e.key;if("Enter"===i||13===r){if(t.isGameOver)return;t.pause()}"Shift"!==i&&16!==r||t.restart(),t.isPause||("ArrowUp"===i||38===r?t.rotate():"ArrowRight"===i||39===r?t.right():"ArrowDown"===i||40===r?t.down():"ArrowLeft"===i||37===r?t.left():" "!==i&&32!==r||t.fall())})),e.eventListener(e.q("#"+this.domId+" .btn-left"),"click",(function(){t.isPause||t.left()})),e.eventListener(e.q("#"+this.domId+" .btn-right"),"click",(function(){t.isPause||t.right()})),e.eventListener(e.q("#"+this.domId+" .btn-down"),"click",(function(){t.isPause||t.down()})),e.eventListener(e.q("#"+this.domId+" .btn-rotate"),"click",(function(){t.isPause||t.rotate()})),e.eventListener(e.q("#"+this.domId+" .btn-fall"),"click",(function(){t.isPause||t.fall()})),e.eventListener(e.q("#"+this.domId+" .tetris-pause"),"click",(function(){t.isGameOver||t.pause()})),e.eventListener(e.q("#"+this.domId+" .tetris-restart"),"click",(function(){t.restart()}))},t.prototype.initDiv=function(t,r,i){for(var n=e.ieBrowerVersion(),o=0;o<r.length;o++){for(var s=[],a=0;a<r[0].length;a++){var c=document.createElement("div");c.className="none",e.isIEBrower&&n<=9?(c.style.top=20*o+"px",c.style.left=20*a+"px"):c.style.transform="translate("+20*a+"px, "+20*o+"px)",t.appendChild(c),s.push(c)}i.push(s)}},t.prototype.refreshDiv=function(t,e){void 0===t&&(t=this.stageArray),void 0===e&&(e=this.stageDivs);for(var r=0;r<t.length;r++)for(var i=0;i<t[0].length;i++)0===t[r][i]?e[r][i].className="none":1===t[r][i]?e[r][i].className="done":2===t[r][i]&&(e[r][i].className="current")},t.prototype.resetPos=function(t){void 0===t&&(t="set");var r,i,n=this.currSquare,o=n.origin.x,s=n.origin.y;for(r=0;r<n.data.length;r++)for(i=0;i<n.data[0].length;i++)e.checkPoint(n.origin,r,i,this.stageArray)&&("clear"===t?this.stageArray[o+r][s+i]=0:"set"===t&&(this.stageArray[o+r][s+i]=n.data[r][i]))},t.prototype.rotate=function(){var t=this.currSquare;t.canRotate(this.stageArray)&&(this.resetPos("clear"),t.rotate(),this.resetPos("set"),this.refreshDiv())},t.prototype.left=function(){var t=this.currSquare;t.canLeft(this.stageArray)&&(this.resetPos("clear"),t.left(),this.resetPos("set"),this.refreshDiv())},t.prototype.right=function(){var t=this.currSquare;t.canRight(this.stageArray)&&(this.resetPos("clear"),t.right(),this.resetPos("set"),this.refreshDiv())},t.prototype.down=function(){var t=this.currSquare;return!!t.canDown(this.stageArray)&&(this.resetPos("clear"),t.down(),this.resetPos("set"),this.refreshDiv(),!0)},t.prototype.fall=function(){for(;this.down(););},t.prototype.fixed=function(){var t,r,i=this.currSquare,n=i.data;for(t=0;t<n.length;t++)for(r=0;r<n[0].length;r++)e.checkPoint(i.origin,t,r,this.stageArray)&&2===this.stageArray[i.origin.x+t][i.origin.y+r]&&(this.stageArray[i.origin.x+t][i.origin.y+r]=1);this.refreshDiv()},t.prototype.checkGameOver=function(){for(var t=0;t<this.stageArray[0].length;t++)if(1===this.stageArray[0][t])return this.audio.play("death"),this.audio.pause("bgm"),!0;return!1},t.prototype.performNext=function(t,e){this.currSquare=this.nextSquare,this.resetPos("set"),this.nextSquare=this.make(t,e),this.refreshDiv(),this.refreshDiv(this.nextSquare.data,this.nextDivs)},t.prototype.checkClear=function(){var t,e,r,i,n=0;for(t=this.stageArray.length-1;t>=0;t--){var o=!0;for(e=0;e<this.stageArray[0].length;e++)if(1!==this.stageArray[t][e]){o=!1;break}if(o){for(this.audio.play("remove"),n+=1,r=t;r>0;r--)for(i=0;i<this.stageArray[0].length;i++)this.stageArray[r][i]=this.stageArray[r-1][i];for(i=0;i<this.stageArray[0].length;i++)this.stageArray[0][i]=0;t++}}return n},t.prototype.make=function(t,e){void 0===t&&(t=1);var r=new n(t);return r.origin.x=0,r.origin.y=3,r.rotate(e),r},t.prototype.move=function(){if(!this.down()){this.fixed();var t=this.checkClear();this.addScore(t),this.checkGameOver()?this.stop():this.performNext(e.rand(7),e.rand(4))}},t.prototype.pause=function(){var t=this;this.isGameOver||(this.isPause?(this.audio.play("bgm",!0),this.isPause=!1,this.moveTimer=setInterval((function(){t.move()}),this.INTERVAL),this.gameTimeMeter(),e.q("#"+this.domId+" .tetris-pause").innerText="Pause"):(this.audio.pause("bgm"),this.isPause=!0,this.moveTimer&&(clearInterval(this.moveTimer),this.moveTimer=null),this.gameTimer&&(clearInterval(this.gameTimer),this.gameTimer=null),e.q("#"+this.domId+" .tetris-pause").innerText="Start"))},t.prototype.restart=function(){var t=this;this.moveTimer&&(clearInterval(this.moveTimer),this.moveTimer=null),this.gameTimer&&(clearInterval(this.gameTimer),this.gameTimer=null);for(var r=0;r<this.stageArray.length;r++)for(var i=0;i<this.stageArray[0].length;i++)this.stageArray[r][i]=0;this.nextSquare=this.make(e.rand(7),e.rand(4)),this.refreshDiv(),this.refreshDiv(this.nextSquare.data,this.nextDivs),this.isGameOver&&(this.audio.pause("death"),this.audio.play("bgm",!0)),this.isGameOver=!1,this.isPause=!1,this.gameTimeMeter(),this.INTERVAL=500,this.gameTimes=0,this.gameScores=0,this.performNext(e.rand(7),e.rand(4)),this.moveTimer=setInterval((function(){t.move()}),this.INTERVAL),e.q("#"+this.domId+" .tetris-pause").innerText="Pause",e.q("#"+this.domId).className="zx-tetris-container"},t.prototype.stop=function(){this.isGameOver=!0,this.moveTimer&&(clearInterval(this.moveTimer),this.moveTimer=null),e.q("#"+this.domId).className="zx-tetris-container game-over"},t.prototype.gameTimeMeter=function(){var t=this;this.gameTimer=setInterval((function(){t.gameTimes++,e.q("#"+t.domId+" .times").innerText=e.ft(t.gameTimes),t.isGameOver&&t.gameTimer&&(clearInterval(t.gameTimer),t.gameTimer=null)}),1e3)},t.prototype.addScore=function(t){var r=0;switch(t){case 1:r=100;break;case 2:r=300;break;case 3:r=600;break;case 4:r=1e3}this.gameScores+=r,e.q("#"+this.domId+" .score").innerText=this.gameScores+"",this.setDownInterval(this.gameScores)},t.prototype.setDownInterval=function(t){t>64e4?this._updateSpeed(100):t>32e4?this._updateSpeed(150):t>16e4?this._updateSpeed(200):t>8e4?this._updateSpeed(250):t>4e4?this._updateSpeed(300):t>2e4?this._updateSpeed(350):t>1e4?this._updateSpeed(400):t>5e3&&this._updateSpeed(450)},t.prototype._updateSpeed=function(t){var e=this;t!==this.INTERVAL&&(this.INTERVAL=t,this.moveTimer&&clearInterval(this.moveTimer),this.moveTimer=setInterval((function(){e.move()}),this.INTERVAL))},t.prototype.init=function(){var t,r=this;if(this.createGameDom(),this.nextSquare=this.make(e.rand(7),e.rand(4)),this.initDiv(e.q("#"+this.domId+" .tetris-stage"),this.stageArray,this.stageDivs),this.initDiv(e.q("#"+this.domId+" .next-square"),this.nextSquare.data,this.nextDivs),this.refreshDiv(this.nextSquare.data,this.nextDivs),this.gameController(),this.performNext(e.rand(7),e.rand(4)),e.isIEBrower&&e.ieBrowerVersion()<10){var i=e.q("body"),n=i.className||"";-1===n.indexOf("ie-brower")&&(i.className="ie-brower "+n)}var o=null===(t=this.dom)||void 0===t?void 0:t.querySelector(".tetris-start-button-wrapper button");o&&o.addEventListener("click",(function(){var t,e;r.audio.play("bgm",!0),(null===(t=r.dom)||void 0===t?void 0:t.querySelector(".tetris-start-button-wrapper")).style.display="none",(null===(e=r.dom)||void 0===e?void 0:e.querySelector(".tetris-control-wrapper")).style.display="block",r.moveTimer=setInterval((function(){r.move()}),r.INTERVAL),r.gameTimeMeter()}))},t}()})();var n=window;for(var o in i)n[o]=i[o];i.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();